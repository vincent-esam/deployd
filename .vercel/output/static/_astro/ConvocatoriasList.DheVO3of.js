import{j as e}from"./jsx-runtime.CLpGMVip.js";import{r as i}from"./index.CXuOLBzL.js";/* empty css                       *//* empty css                       */import{M as z}from"./modale.D-yblIho.js";const D=({onSearch:a})=>{const[t,r]=i.useState(""),n=()=>{a(t)};return e.jsx("div",{className:"v-row",children:e.jsxs("div",{className:"v-col",children:[e.jsx("div",{className:"v-input v-input--horizontal",children:e.jsx("div",{className:"v-input__control",children:e.jsxs("div",{className:"v-field",children:[e.jsx("label",{htmlFor:"search-input",children:"Ingrese datos a buscar"}),e.jsx("input",{type:"text",id:"search-input",value:t,onChange:h=>r(h.target.value),className:"v-field__input"})]})})}),e.jsx("button",{type:"button",onClick:n,className:"v-btn",children:"Buscar"})]})})};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),E=(...a)=>a.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var R={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=i.forwardRef(({color:a="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:h="",children:l,iconNode:m,...d},c)=>i.createElement("svg",{ref:c,...R,width:t,height:t,stroke:a,strokeWidth:n?Number(r)*24/Number(t):r,className:E("lucide",h),...d},[...m.map(([u,v])=>i.createElement(u,v)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=(a,t)=>{const r=i.forwardRef(({className:n,...h},l)=>i.createElement(A,{ref:l,iconNode:t,className:E(`lucide-${O(a)}`,n),...h}));return r.displayName=`${a}`,r};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],B=S("CircleCheckBig",M);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],T=S("EllipsisVertical",$);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],U=S("Pencil",V),G=({idConvocatoria:a,titulo:t,perfil:r,requisitos:n,fechaInicio:h,totalPostulantes:l,link:m,estadoInicial:d,onAbrir:c,onEditar:u})=>{const[v,f]=i.useState(!1),[x,y]=i.useState(!1),[b,w]=i.useState(d),C=()=>{navigator.clipboard.writeText(m),f(!0),setTimeout(()=>f(!1),2e3)},_=()=>{y(!x)},F=async()=>{const k=b==="abierta"?"cerrada":"abierta";w(k);try{if(!(await fetch("/api/convocatorias/updateEstado",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({idConvocatoria:a,estado:k})})).ok)throw new Error("Error al actualizar el estado");console.log("Estado actualizado correctamente")}catch(N){console.error(N),w(b)}};return e.jsxs("div",{className:"v-card v-theme--light v-card--density-default v-card--variant-elevated mb-4",children:[e.jsx("div",{className:"v-card__loader",children:e.jsxs("div",{className:"v-progress-linear v-theme--light v-locale--is-ltr",role:"progressbar","aria-hidden":"true","aria-valuemin":0,"aria-valuemax":100,style:{top:"0px",height:"0px",left:"50%",transform:"translateX(-50%)"},children:[e.jsx("div",{className:"v-progress-linear__background",style:{width:"100%"}}),e.jsxs("div",{className:"v-progress-linear__indeterminate",children:[e.jsx("div",{className:"v-progress-linear__indeterminate long"}),e.jsx("div",{className:"v-progress-linear__indeterminate short"})]})]})}),e.jsxs("div",{className:"result-item",children:[e.jsxs("div",{className:"menu-container",children:[e.jsx("button",{onClick:_,className:"menu-button",children:e.jsx(T,{size:24})}),x&&e.jsxs("div",{className:"menu-options",children:[e.jsxs("button",{className:"option-button",onClick:()=>u(a),children:[e.jsx(U,{size:18})," Editar"]}),e.jsxs("button",{className:"option-button",onClick:F,children:[e.jsx(B,{size:18,color:b==="cerrada"?"gray":"green"}),b==="cerrada"?"Reabrir":"Finalizar"]})]})]}),e.jsxs("div",{className:"v-card-content",children:[e.jsx("div",{className:"v-card-title sub-title",children:t}),e.jsxs("div",{className:"v-card-subtitle",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Perfil:"})," ",r]}),e.jsx("br",{}),e.jsxs("p",{children:[e.jsx("strong",{children:"Requisitos:"})," ",n]}),e.jsx("br",{}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha Inicio:"})," ",h]}),e.jsx("br",{}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Postulantes:"})," ",l]}),e.jsx("br",{}),e.jsxs("p",{children:[e.jsx("strong",{children:"Link:"})," ",e.jsx("a",{href:m,target:"_blank",rel:"noopener noreferrer",children:m})]}),e.jsx("br",{}),e.jsx("button",{className:"copy-button",onClick:C,children:"ðŸ“‹ Copiar Link"}),v&&e.jsx("span",{className:"copy-message",children:"Â¡Copiado!"})]})]}),e.jsx("div",{className:"v-card-actions",children:e.jsxs("button",{type:"button",className:"v-btn v-btn--slim v-theme--light v-btn--density-default v-btn--size-default v-btn--variant-text button-card",onClick:()=>c(a),children:[e.jsx("span",{className:"v-btn__overlay"}),e.jsx("span",{className:"v-btn__underlay"}),e.jsx("a",{children:"ABRIR"})]})})]})]})},J=({onClose:a,convocatoriaToEdit:t})=>{const r=d=>d?new Date(d).toISOString().split("T")[0]:"",[n,h]=i.useState({titulo:t?.titulo||"",perfil:t?.perfil||"",fechaInicio:r(t?.fechaInicio),fechaFinal:r(t?.fechaFinal),requisitos:t?.requisitos||""}),l=d=>{const{name:c,value:u}=d.target;h(v=>({...v,[c]:u}))},m=async d=>{d.preventDefault();try{const c=new FormData;Object.keys(n).forEach(x=>{c.append(x,n[x])});const u=t?`http://localhost:4321/api/convocatorias/updateConvocatorias/${t.idConvocatoria}`:"http://localhost:4321/api/convocatorias/insert_convocatorias";if(!(await fetch(u,{method:t?"PUT":"POST",body:c})).ok)throw new Error("Error al guardar la convocatoria");alert(t?"Convocatoria actualizada con Ã©xito":"Convocatoria creada con Ã©xito"),a()}catch(c){console.error("Error:",c),alert("Error al guardar la convocatoria")}};return e.jsxs("form",{className:"create-form",onSubmit:m,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"titulo",children:"TÃ­tulo"}),e.jsx("input",{type:"text",id:"titulo",name:"titulo",required:!0,value:n.titulo,onChange:l})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"perfil",children:"Perfil"}),e.jsx("textarea",{id:"perfil",name:"perfil",required:!0,rows:4,value:n.perfil,onChange:l})]}),e.jsx("div",{className:"form-group",children:e.jsx("label",{htmlFor:"requisitos",children:"Requisitos"})}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"requisitos",value:"docente",checked:n.requisitos==="docente",onChange:l}),"Docente"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"requisitos",value:"tutor",checked:n.requisitos==="tutor",onChange:l}),"Tutor"]})]}),e.jsxs("div",{className:"form-group grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fechaInicio",children:"Fecha de Inicio"}),e.jsx("input",{type:"date",id:"fechaInicio",name:"fechaInicio",required:!0,value:n.fechaInicio,onChange:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fechaFinal",children:"Fecha de Fin"}),e.jsx("input",{type:"date",id:"fechaFinal",name:"fechaFinal",required:!0,value:n.fechaFinal,onChange:l})]})]}),e.jsx("button",{type:"submit",className:"submit-button mt-4",children:"Guardar"})]})},K=({postulantes:a,onVolver:t})=>e.jsxs("div",{className:"results-container",children:[e.jsx("h2",{children:"Postulantes"}),e.jsxs("button",{type:"button",className:"v-btn v-btn--slim v-theme--light v-btn--density-default v-btn--size-default v-btn--variant-text button-card",onClick:t,children:[e.jsx("span",{className:"v-btn__overlay"}),e.jsx("span",{className:"v-btn__underlay"}),e.jsx("a",{children:"Volver"})]}),a.length>0?a.map(r=>e.jsx("div",{className:"v-card v-theme--light v-card--variant-elevated mb-4",children:e.jsxs("div",{className:"result-item",children:[e.jsxs("div",{className:"v-card-content",children:[e.jsxs("div",{className:"v-card-title sub-title",children:[r.nombre," ",r.apellidoPaterno," ",r.apellidoMaterno]}),e.jsx("div",{className:"v-card-subtitle",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de PostulaciÃ³n:"})," ",r.fechaPostulacion]})})]}),e.jsx("div",{className:"v-card-actions",children:e.jsxs("button",{type:"button",className:"v-btn v-btn--slim v-theme--light v-btn--density-default v-btn--size-default v-btn--variant-text button-card",children:[e.jsx("span",{className:"v-btn__overlay"}),e.jsx("span",{className:"v-btn__underlay"}),e.jsx("a",{href:`/postulantes/info/${r.idDocente}`,children:"ABRIR"})]})})]})},r.idDocente)):e.jsx("p",{className:"no-results",children:"No hay postulantes para esta convocatoria."})]}),Y=()=>{const[a,t]=i.useState([]),[r,n]=i.useState([]),[h,l]=i.useState(!0),[m,d]=i.useState(null),[c,u]=i.useState(!1),[v,f]=i.useState(null),[x,y]=i.useState(null),[b,w]=i.useState(""),C=s=>s?new Date(s).toISOString().split("T")[0]:"";i.useEffect(()=>{(async()=>{try{const o=await fetch("http://localhost:4321/api/convocatorias/convocatorias");if(!o.ok)throw new Error("Error al obtener las convocatorias");const p=(await o.json()).map(g=>({...g,fechaInicio:C(g.fechaInicio),fechaFinal:C(g.fechaFinal),postulantes:g.postulantes.map(I=>({...I,fechaPostulacion:C(I.fechaPostulacion)}))})),P=p.filter(g=>g.estado.toLowerCase()==="abierta");t(p),n(P)}catch(o){d(o.message)}finally{l(!1)}})()},[]);const _=s=>{if(s.trim()==="")n(a);else{const o=s.toLowerCase(),j=a.filter(p=>p.titulo&&p.titulo.toLowerCase().includes(o)||p.perfil&&p.perfil.toLowerCase().includes(o)||p.requisitos&&p.requisitos.toLowerCase().includes(o));n(j)}},F=s=>{w(s);let o=a;(s==="abierta"||s==="cerrada")&&(o=o.filter(j=>j.estado.toLowerCase()===s.toLowerCase())),n(o)},k=s=>{const o=a.find(j=>j.idConvocatoria===s);o&&(y(o),u(!0))},N=()=>{u(!1),y(null)},L=s=>{const o=a.find(j=>j.idConvocatoria===s);o&&f(o)},q=()=>{f(null)};return h?e.jsx("div",{children:"Loading..."}):m?e.jsxs("div",{children:["Error: ",m]}):e.jsxs("div",{className:"docente-search-container",children:[v?e.jsx(K,{postulantes:v.postulantes,onVolver:q}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"filters-container",children:[e.jsx(D,{onSearch:_}),e.jsx("label",{htmlFor:"estado-select",children:"Buscar por estado"}),e.jsxs("select",{className:"filter-select",value:b,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"abierta",children:"Abierta"}),e.jsx("option",{value:"cerrada",children:"Cerrada"})]}),e.jsx("button",{className:"v-btn",onClick:()=>u(!0),children:"Crear"})]}),e.jsx("div",{className:"results-container",children:r.length>0?r.map(s=>e.jsx(G,{idConvocatoria:s.idConvocatoria,titulo:s.titulo,perfil:s.perfil,requisitos:s.requisitos,fechaInicio:s.fechaInicio,totalPostulantes:s.totalPostulantes,link:s.link,estadoInicial:s.estado,onAbrir:L,onEditar:k},s.idConvocatoria)):e.jsx("p",{className:"no-results",children:"No se encontraron resultados."})})]}),e.jsx(z,{isOpen:c,onClose:N,title:x?"Editar Convocatoria":"Crear Convocatoria",children:e.jsx(J,{onClose:N,convocatoriaToEdit:x})})]})};export{Y as ConvocatoriasList};
